<div class="flex w-full">
    <div class="absolute h-[650px] md:h-[650] lg:h-[650px]">

        <div id="friends-page" class="backdrop-blur-sm absolute top-0 left-0 h-full bg-black/50 shadow-[4px_4px_10px_0px_rgba(0,0,0,0.5)] transition-all duration-300 ease-in-out">
            <div class="p-4 text-gray-50 h-full">
                <div class="space-y-4" id="party-invites">
                    <div class="flex flex-col justify-center items-center bg-gray-600 border border-gray-200 p-2 my-2 cursor-pointer transition-all duration-300 group-hover:h-auto group-hover:py-4 group-hover:bg-gray-700 group-hover:rounded-lg">
                        <span class="group-hover:none text-center transition-opacity duration-300 group-hover:opacity-0">1</span>
                        <span class="hidden group-hover:block text-center transition-opacity duration-300 opacity-0 group-hover:opacity-100 group-hover:block">Party Invites</span>
                        <div class="hidden group-hover:block w-full bg-gray-800 text-white p-2 rounded shadow-md opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                            Your first hover tooltip content goes here.
                        </div>
                        <div class="hidden group-hover:block w-full bg-gray-800 text-white p-2 rounded shadow-md opacity-0 transition-opacity duration-300 group-hover:opacity-100 mt-2">
                            Your second hover tooltip content goes here.
                        </div>
                    </div>
                </div>

                <!-- Friend Request section -->
                <!-- Hidden when no requestg -->
                <div class="space-y-4" id="party-invites">
                    <div class="flex flex-col justify-center items-center bg-gray-600 border border-gray-200 p-2 my-2 cursor-pointer transition-all duration-300 group-hover:h-auto group-hover:py-4 group-hover:bg-gray-700 group-hover:rounded-lg">
                        <span class="group-hover:none text-center transition-opacity duration-300 group-hover:opacity-0">1</span>
                        <span class="hidden group-hover:block text-center transition-opacity duration-300 opacity-0 group-hover:opacity-100 group-hover:block">Party Invites</span>
                        <div class="hidden group-hover:block w-full bg-gray-800 text-white p-2 rounded shadow-md opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                            Your first hover tooltip content goes here.
                        </div>
                        <div class="hidden group-hover:block w-full bg-gray-800 text-white p-2 rounded shadow-md opacity-0 transition-opacity duration-300 group-hover:opacity-100 mt-2">
                            Your second hover tooltip content goes here.
                        </div>
                    </div>
                </div>

                <!-- Friend Request section -->

                <div class="space-y-4 h-full overflow-y-auto" id="online-friend-list"></div>
<!--                <div class="space-y-4" id="offline-friend-list"></div>-->
            </div>
        </div>
    </div>
</div>
<script id="script-friends">
    const friendElements = document.getElementsByClassName("friend-element")
    const friendDetails = document.getElementsByClassName("friend-details")
    const allFriendUsernames = new Set()

    const FRIEND_STATES = {
        AVAILABLE: "Available",
        IN_GAME: "In Game",
        OFFLINE: "Offline",
    }


    function createInviteButton(username) {
        deleteInviteButton(username)
        let button = document.createElement("button")
        button.className = "px-2 py-1 text-xs bg-blue-500 hover:bg-blue-600 text-white rounded friend-action-invite"
        document.getElementById(`connection-${username}`).getElementsByClassName("friend-action-invite")[0].innerHTML = state
    }


    function deleteInviteButton(username) {
        let inviteButton = document.getElementById(`connection-${username}`).getElementsByClassName("friend-action-invite")
        if (inviteButton.length === 0) document.getElementById(`connection-${username}`).getElementsByClassName("friend-action-invite")[0].remove()
    }


    function friendStateChanged(username, state) {
        let friendDiv = document.getElementById(`connection-${username}`)
        if (state === FRIEND_STATES.AVAILABLE) createInviteButton()
        else deleteInviteButton({username})
        friendDiv.getElementsByClassName("friend-state")[0].innerHTML = state
    }


    function friendRemoved(username) {
        allFriendUsernames.delete(`connection-${username}`)
        let friendDiv = document.getElementById(`connection-${username}`)
        if (friendDiv !== null) {
            friendDiv.remove()
        }
    }

    let lastFriendActionTriggeredHover = null
    let lastFriendActionTriggeredVisible = null
    function friendAdded(friendData) {
        allFriendUsernames.add(friendData["USERNAME"])
        let friendElement = document.createElement("div")
        friendElement.id = `connection-${friendData["USERNAME"]}`
        friendElement.className = "flex items-center space-x-2 hover:bg-gray-600 p-2 rounded-lg w-16 relative overflow-visible friend-element"
        let group = document.createElement("div")
        group.className = "relative group flex items-center space-x-2"
        let PFP = document.createElement("img")
        PFP.src = friendData["PFP"]
        PFP.className = "h-10 w-10"
        group.appendChild(PFP)
        let visiblePart = document.createElement("div")
        visiblePart.className = "flex flex-col text-sm friend-details"
        let usernameDIV = document.createElement("div")
        usernameDIV.className = "flex items-center space-x-2"
        usernameDIV.innerText = friendData["USERNAME"]
        let stateDiv = document.createElement("div")
        stateDiv.className = "text-green-400 friend-state"
        stateDiv.innerText = friendData["STATE"]
        visiblePart.append(usernameDIV)
        visiblePart.append(stateDiv)
        group.appendChild(visiblePart)
        let hoverPart = document.createElement("div")
        hoverPart.className = "gap-1 flex flex-col absolute top-1/2 left-full transform -translate-y-1/2 translate-x-2 p-2 rounded shadow-md opacity-100 transition-opacity duration-300 whitespace-nowrap z-10"
        let inviteButton = document.createElement("button")
        inviteButton.className = "bg-gray-800 text-white border border-white/30 text-sm rounded px-2 py-1 friend-action-invite friend-sub-category-button"
        inviteButton.innerText = "INVITE"
        let joinButton = document.createElement("button")
        joinButton.className = "bg-gray-800 text-white border border-white/30 text-sm rounded px-2 py-1 friend-action-request friend-sub-category-button"
        joinButton.innerText = "JOIN"
        let messageButton = document.createElement("button")
        messageButton.className = "bg-gray-800 text-white border border-white/30 text-sm rounded px-2 py-1 friend-action-request friend-sub-category-button"
        messageButton.innerText = "MESSAGE"
        messageButton.onclick = function () { changeChatReceiver(friendData["USERNAME"]) }
        hoverPart.append(inviteButton)
        hoverPart.append(joinButton)
        hoverPart.append(messageButton)
        group.appendChild(hoverPart)
        friendElement.appendChild(group)
        friendElement.onclick = function() {
            hideLastOpenedFriendAction()
            lastFriendActionTriggeredHover = hoverPart
            lastFriendActionTriggeredVisible = visiblePart
            lastFriendActionTriggeredHover.classList.remove("hidden")
            lastFriendActionTriggeredVisible.classList.add("hidden")
        }
        waitForElementPresence("#online-friend-list", (div)=> {
            if (div.classList.contains("expanded") === true) {
                friendElement.classList.add("w-48")
                friendElement.classList.remove("w-16")
            } else {
                visiblePart.classList.add("hidden")
                friendElement.classList.add("w-16")
                friendElement.classList.remove("w-48")
                hoverPart.classList.add("hidden")
            }
            div.append(friendElement)
        })
    }

    function hideLastOpenedFriendAction() {
        if (lastFriendActionTriggeredHover) lastFriendActionTriggeredHover.classList.add("hidden")
        if (lastFriendActionTriggeredVisible) lastFriendActionTriggeredVisible.classList.remove("hidden")
    }

    function inviteFriend(username) {

    }


    function joinFriend(username) {

    }


    waitForElementPresence("#friends-page", (friendsPage)=> {
        friendsPage.onmouseleave = function() {
            hideLastOpenedFriendAction()
            Array.prototype.filter.call(
                friendElements,
                (friendElement) => {
                    friendElement.classList.remove("w-48")
                    friendElement.parentElement.classList.remove("expanded")
                    friendElement.classList.add("w-16")
                },
            );
            Array.prototype.filter.call(
                friendDetails,
                (friendDetail) => {
                    friendDetail.classList.add("hidden")
                },
            );
        }
        friendsPage.onmouseenter = function () {
            Array.prototype.filter.call(
                friendElements,
                (friendElement) => {
                    friendElement.classList.add("w-48")
                    friendElement.parentElement.classList.add("expanded")
                    friendElement.classList.remove("w-16")
                },
            );
            Array.prototype.filter.call(
                friendDetails,
                (friendDetail) => {
                    friendDetail.classList.remove("hidden")
                },
            );
        }
    })
</script>